!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Map=t()}}(function(){return function t(e,i,s){function n(o,h){if(!i[o]){if(!e[o]){var a="function"==typeof require&&require;if(!h&&a)return a(o,!0);if(r)return r(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var l=i[o]={exports:{}};e[o][0].call(l.exports,function(t){var i=e[o][1][t];return n(i?i:t)},l,l.exports,t,e,i,s)}return i[o].exports}for(var r="function"==typeof require&&require,o=0;o<s.length;o++)n(s[o]);return n}({1:[function(t,e){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function s(t){return"function"==typeof t}function n(t){return"number"==typeof t}function r(t){return"object"==typeof t&&null!==t}function o(t){return void 0===t}e.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(t){if(!n(t)||0>t||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},i.prototype.emit=function(t){var e,i,n,h,a,u;if(this._events||(this._events={}),"error"===t&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;throw TypeError('Uncaught, unspecified "error" event.')}if(i=this._events[t],o(i))return!1;if(s(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:for(n=arguments.length,h=new Array(n-1),a=1;n>a;a++)h[a-1]=arguments[a];i.apply(this,h)}else if(r(i)){for(n=arguments.length,h=new Array(n-1),a=1;n>a;a++)h[a-1]=arguments[a];for(u=i.slice(),n=u.length,a=0;n>a;a++)u[a].apply(this,h)}return!0},i.prototype.addListener=function(t,e){var n;if(!s(e))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,s(e.listener)?e.listener:e),this._events[t]?r(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,r(this._events[t])&&!this._events[t].warned){var n;n=o(this._maxListeners)?i.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())}return this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(t,e){function i(){this.removeListener(t,i),n||(n=!0,e.apply(this,arguments))}if(!s(e))throw TypeError("listener must be a function");var n=!1;return i.listener=e,this.on(t,i),this},i.prototype.removeListener=function(t,e){var i,n,o,h;if(!s(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(i=this._events[t],o=i.length,n=-1,i===e||s(i.listener)&&i.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(r(i)){for(h=o;h-->0;)if(i[h]===e||i[h].listener&&i[h].listener===e){n=h;break}if(0>n)return this;1===i.length?(i.length=0,delete this._events[t]):i.splice(n,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},i.prototype.removeAllListeners=function(t){var e,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[t],s(i))this.removeListener(t,i);else for(;i.length;)this.removeListener(t,i[i.length-1]);return delete this._events[t],this},i.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?s(this._events[t])?[this._events[t]]:this._events[t].slice():[]},i.listenerCount=function(t,e){var i;return i=t._events&&t._events[e]?s(t._events[e])?1:t._events[e].length:0}},{}],2:[function(t,e){var i=t("./mercator"),s=t("./MapUtils"),n=t("./Rect"),r=t("./Tile"),o=t("events");e.exports=function(){function t(t,e,n,r,h,a){this.mercator=i,this.utils=s,this.provider=t||"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",this.domains=e||["a","b","c"],this._width=n||i.tileSize,this._height=r||i.tileSize,this._minZoom=Math.max(0,h),this._maxZoom=Math.max(1,a),this.latitude=0,this.longitude=0,this.zoom=0,this.tiles=[],this.keys=[],this.loadedTiles=[],this.scale=window.devicePixelRatio||1,this.retina=1!=this.scale,this.isNode="undefined"==typeof window,this.isNode||(this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.ctx.imageSmoothingEnabled=!this.retina,this.ctx.mozImageSmoothingEnabled=!this.retina,this.ctx.msImageSmoothingEnabled=!this.retina),this.setSize(this._width,this._height,!0),this.eventEmitter=new o.EventEmitter}function e(t,e,i){this._width=t,this._height=e,this.viewRect=new n(0,0,this._width,this._height),null!=this.canvas&&(this.canvas.width=this.viewRect.w*this.scale,this.canvas.height=this.viewRect.h*this.scale,this.canvas.style.width=this.viewRect.w+"px",this.canvas.style.height=this.viewRect.h+"px"),1!=Boolean(i)&&this.setView(this.latitude,this.longitude,this.zoom)}function h(){if(!this.isNode){this.ctx.clearRect(0,0,this.viewRect.w,this.viewRect.h),this.ctx.restore(),this.ctx.save(),this.retina&&this.ctx.scale(this.scale,this.scale);var e=this.getViewRectCenterPixels(),i=this.ctx,s=this.zoom,n=this.viewRect;this.loadedTiles.forEach(function(t){if(t.zoom==s){var r=n.x+n.w/2+(t.px-e[0]),o=n.y+n.h/2+(t.py-e[1]);i.drawImage(t.img,Math.round(r),Math.round(o))}}),this.eventEmitter.emit(t.ON_TEXTURE_UPDATE,this.ctx)}}function a(){return[this.latitude,this.longitude]}function u(){return{lat:this.latitude,lng:this.longitude}}function l(t,e,s){var n=i.latLngToPixels(-t,e,s),r=this.viewRect.w,o=this.viewRect.h,h=i.pixelsToLatLng(n[0]-r/2,n[1]-o/2,s),a=i.pixelsToLatLng(n[0]+r/2,n[1]+o/2,s);return[-h[0],h[1],-a[0],a[1]]}function c(){var t=this.viewRectToLatLng(this.latitude,this.longitude,this.zoom);return{left:t[1],top:t[0],right:t[3],bottom:t[2]}}function f(t,e,s){var r=i.latLngToPixels(-t,e,s);return new n(r[0]-this.viewRect.w/2,r[1]-this.viewRect.h/2,this.viewRect.w,this.viewRect.h)}function d(){var t=l(this.latitude,this.longitude,this.zoom,this.viewRect);return[s.map(.5,0,1,-t[0],-t[2]),s.map(.5,0,1,t[1],t[3])]}function v(){return i.latLngToPixels(-this.latitude,this.longitude,this.zoom)}function m(){var t=i.latLngToPixels(-this.latitude,this.longitude,this.zoom),e=this.viewRect.w,s=this.viewRect.h;return i.pixelsToLatLng(t[0]-e/2,t[1]-s/2,this.zoom)}function p(t){for(var e=0;e<this.tiles.length;e++)if(this.tiles[e].key==t)return this.tiles[e];return null}function g(t){t=t||this.zoom;for(var e=this.viewRectToLatLng(this.latitude,this.longitude,t,this.viewRect),s=i.latLonToTile(-e[0],e[1],t),n=i.latLonToTile(-e[2],e[3],t),r=0,o=0,h=s[0];h<=n[0];h++)r++;for(var a=s[1];a<=n[1];a++)o++;return[e[0],e[1],r,o]}function L(t){t=t||this.zoom;for(var e=l(this.latitude,this.longitude,t,this.viewRect),s=i.latLonToTile(-e[0],e[1],t),n=i.latLonToTile(-e[2],e[3],t),r=0,o=0,h=[],a=s[0];a<=n[0];a++){o=0;for(var u=s[1];u<=n[1];u++){for(var c=i.tileXYToQuadKey(a,u,t),f=!1,d=0;d<this.loadedTiles.length;d++)if(this.loadedTiles[d].key==c){this.loadedTiles[d].viewRectPosition[0]=r,this.loadedTiles[d].viewRectPosition[1]=o,h.push(this.loadedTiles[d]),f=!0;break}if(0==f)for(d=0;d<this.tiles.length;d++)if(this.tiles[d].key==c){this.tiles[d].viewRectPosition[0]=r,this.tiles[d].viewRectPosition[1]=o,h.push(this.tiles[d]),f=!0;break}o++}r++}return h}function x(t,e,s,n){for(var o=this.viewRectToLatLng(t,e,s,n),h=i.latLonToTile(-o[0],o[1],s),a=i.latLonToTile(-o[2],o[3],s),u=[],l=h[0];l<=a[0];l++)for(var c=h[1];c<=a[1];c++){var f=i.tileXYToQuadKey(l,c,s);if(-1==this.keys.indexOf(f)){var d=new r(this,f);u.push(d),this.keys.push(f)}}return u}function _(t,e,i){this.latitude=t||this.latitude,this.longitude=e||this.longitude,this.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,i||this.zoom)),this.load(),this.renderTiles()}function w(){var e=this.getVisibleTiles(this.latitude,this.longitude,this.zoom,this.viewRect);if(0==e.length&&0==this.tiles.length)return void this.eventEmitter.emit(t.ON_LOAD_COMPLETE,-1);for(var i=0;i<e.length;i++)e[i].eventEmitter.on(r.ON_TILE_LOADED,this.appendTile),e[i].load();this.tiles=this.tiles.concat(e)}function y(e){var i=e.map;i.tiles.splice(i.tiles.indexOf(e),1);e.img;i.loadedTiles.push(e),i.renderTiles(!0),i.eventEmitter.emit(t.ON_TILE_LOADED,e),0==i.tiles.length&&i.eventEmitter.emit(t.ON_LOAD_COMPLETE,0)}function T(t,e,s){return i.latLngToPixels(-t,e,s||this.zoom)}function E(t){return t=t||this.zoom,i.resolution(t)}function b(){var t=this;this.tiles.forEach(function(e){e.eventEmitter.removeListener(r.ON_TILE_LOADED,t.appendTile),e.dispose()}),this.loadedTiles.forEach(function(t){t.dispose()}),this.tiles=[],this.loadedTiles=[],this.keys=[]}t.prototype={get width(){return this._width},set width(t){this._width=t,this.setSize(this.width,this.height,!0)},get height(){return this._height},set height(t){this._height=t,this.setSize(this.width,this.height,!0)},get minZoom(){return this._minZoom},set minZoom(t){this._minZoom=t},get maxZoom(){return this._maxZoom},set maxZoom(t){this._maxZoom=t}},t.ON_LOAD_COMPLETE=0,t.ON_TILE_LOADED=1,t.ON_TEXTURE_UPDATE=2;var M=t.prototype;return M.constructor=t,M.setSize=e,M.renderTiles=h,M.latLngToPixels=T,M.getCenter=a,M.getCenterLatLng=u,M.viewRectToLatLng=l,M.getViewPortBounds=c,M.viewRectToPixels=f,M.getViewRectCenter=d,M.getViewRectCenterPixels=v,M.getViewRctTopLeft=m,M.setView=_,M.getTileByKey=p,M.viewRectTilesDelta=g,M.viewRectTiles=L,M.getVisibleTiles=x,M.load=w,M.appendTile=y,M.resolution=E,M.dispose=b,t}()},{"./MapUtils":3,"./Rect":5,"./Tile":6,"./mercator":7,events:1}],3:[function(t,e){e.exports.MapUtils=function(t){function e(t){return(t&-t)==t}function i(t){if(e(t))return t;for(var i=1;~~t>i;)i<<=1;return i}function s(t,e,i,s){var n=EARTH_RADIUS,r=t*h,o=i*h,a=(i-t)*h,u=(s-e)*h,l=Math.sin(a/2)*Math.sin(a/2)+Math.cos(r)*Math.cos(o)*Math.sin(u/2)*Math.sin(u/2),c=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l));return n*c}function n(t,e,i){return e+t*(i-e)}function r(t,e,i){return(t-e)/(i-e)}function o(t,e,i,s,o){return n(r(t,e,i),s,o)}var h=Math.PI/180;return t.lerp=n,t.norm=r,t.map=o,t.isPowerOfTwo=e,t.powerTwo=i,t.latLngDistance=s,t}(e.exports)},{}],4:[function(t,e){e.exports=function(t){function e(e,i){_=e||256,w=i||6378137,y=2*Math.PI*w/_,T=2*Math.PI*w/2,t.tileSize=_,t.earthRadius=w,t.initialResolution=y,t.originShift=T}function i(t,e){var i=e*T/180,s=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180);return s=s*T/180,[i,s]}function s(t,e){var i=t/T*180,s=e/T*180;return s=180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2),[s,i]}function n(t,e,i){var s=d(i),n=t*s-T,r=e*s-T;return[n,r]}function r(t,e,i){var s=d(i),n=(t+T)/s,r=(e+T)/s;return[n,r]}function o(t,e,i){var s=r(t,e,i);return h(s[0],s[1])}function h(t,e){var i=parseInt(Math.ceil(t/parseFloat(_))-1),s=parseInt(Math.ceil(e/parseFloat(_))-1);return[i,s]}function a(t,e,i){var s=p(t,e,i);return h(s[0],s[1])}function u(t,e,i){var s=_<<i;return[t,s-e]}function l(t,e,i){var s=n(t*_,e*_,i),r=n((t+1)*_,(e+1)*_,i);return[s[0],s[1],r[0],r[1]]}function c(t,e,i){var s=l(t,e,i),n=r(s[0],s[1],i),o=r(s[2],s[3],i);return[n[0],n[1],o[0],o[1]]}function f(t,e,i){var n=l(t,e,i),r=s(n[0],n[1]),o=s(n[2],n[3]);return[r[0],r[1],o[0],o[1]]}function d(t){return y/Math.pow(2,t)}function v(t){for(var e=30;t>d(e);)if(e--,0>=e)return 0;return e}function m(t,e,i){var r=n(t,e,i);return s(r[0],r[1])}function p(t,e,s){var n=i(t,e,s);return r(n[0],n[1],s)}function g(t,e,s){var n=i(t,e);return o(n[0],n[1],s)}function L(t,e,i){for(var s="",n=i;n>0;n--){var r=0,o=1<<n-1;0!=(t&o)&&r++,0!=(e&o)&&(r++,r++),s+=r}return s}function x(t){for(var e=0,i=0,s=t.split(""),n=s.length,r=n;r>0;r--){var o=1<<r-1;switch(s[n-r]){case"0":break;case"1":e|=o;break;case"2":i|=o;break;case"3":e|=o,i|=o;break;default:return null}}return{tx:e,ty:i,zoom:n}}var _=256,w=6378137,y=2*Math.PI*w/_,T=2*Math.PI*w/2;return t.tileSize=_,t.earthRadius=w,t.initialResolution=y,t.originShift=T,t.init=e,t.latLonToMeters=i,t.metersToLatLon=s,t.pixelsToMeters=n,t.metersToPixels=r,t.metersToTile=o,t.pixelsToTile=h,t.latLonToTile=a,t.pixelsToRaster=u,t.tileMetersBounds=l,t.tilePixelsBounds=c,t.tileLatLngBounds=f,t.resolution=d,t.zoomForPixelSize=v,t.pixelsToLatLng=m,t.latLngToPixels=p,t.latLngToTile=g,t.tileXYToQuadKey=L,t.quadKeyToTileXY=x,t}({})},{}],5:[function(t,e){e.exports=function(){function t(t,e,i,s){this.x=t,this.y=e,this.w=i,this.h=s}function e(t,e){return t<this.x?!1:e<this.y?!1:t>this.x+this.w?!1:e<=this.y+this.h}function i(t,e,i,s){return this.x>=t&&this.y>=e&&this.x+this.w<=t+i&&this.y+this.h<=e+s}function s(t,e,i,s){return!(t>this.x+this.w||t+i<this.x||e>this.y+this.h||e+s<this.y)}function n(e){if(this.intersect(e.x,e.y,e.x+e.w,e.y+e.h)){var i=Math.max(this.x,e.x),s=Math.max(this.y,e.y),n=Math.min(this.x+this.w,e.x+e.w)-i,r=Math.min(this.y+this.h,e.y+e.h)-s;return new t(i,s,n,r)}return null}t.prototype={get x(){return this._x},set x(t){return this._x=t,this._x},get y(){return this._y},set y(t){return this._y=t,this._y},get w(){return this._w},set w(t){return this._w=t,this._w},get h(){return this._h},set h(t){return this._h=t,this._h}};var r=t.prototype;return r.constructor=t,r.containsPoint=e,r.isContained=i,r.intersect=s,r.intersection=n,t}()},{}],6:[function(t,e){var i=t("./Mercator"),s=t("events");e.exports=function(){function t(t,e){if(null==t)throw new Error("Tile: no map associated to Tile.");this.map=t,this.valid=!0,this.loaded=!1,this.key="",this.id=-1,this.tx=-1,this.ty=-1,this.zoom=-1,this.lat=-1,this.lng=-1,this.meterBounds=c,this.mx=-1,this.my=-1,this.pixelBounds=c,this.px=-1,this.py=-1,this.rx=0,this.ry=0,this.viewRectPosition=[0,0],this.latLngBounds=c,this.img=this.map.isNode?{}:new Image,this.url="",this.eventEmitter=new s.EventEmitter,this.quadKey=this.key=e,this.quadKey!=c&&this.initFromQuadKey(this.quadKey)}function e(t,e,s){var r=i.tileXYToQuadKey(t,e,s);n(r)}function n(t){var e=i.quadKeyToTileXY(t);if(e==c)return void(this.valid=!1);var s=i.tileLatLngBounds(this.tx+.5,this.ty+.5,this.zoom);this.lat=-s[0],this.lng=s[1],this.key=t,this.id=parseInt(t),this.tx=e.tx,this.ty=e.ty,this.zoom=e.zoom,this.meterBounds=i.tileMetersBounds(this.tx,this.ty,this.zoom),this.mx=this.meterBounds[0],this.my=this.meterBounds[1],this.pixelBounds=i.tilePixelsBounds(this.tx,this.ty,this.zoom),this.px=this.pixelBounds[0],this.py=this.pixelBounds[1],this.latLngBounds=i.tileLatLngBounds(this.tx,this.ty,this.zoom),this.latLngBounds[0]*=-1,this.latLngBounds[2]*=-1,this.url=this.getMapUrl(this.tx,this.ty,this.zoom)}function r(){if(this.map.isNode)return void this.eventEmitter.emit(t.ON_TILE_LOADED,this);var e=this;this.img.tile=this,this.img.crossOrigin="anonymous",this.img.onload=function(){e.loaded=!0,e.eventEmitter.emit(t.ON_TILE_LOADED,e)},this.img.setAttribute("key",this.key),this.img.src=this.url}function o(t,e,i){var s=this.map.provider;if(s=s.replace(/\{x\}/,t),s=s.replace(/\{y\}/,e),s=s.replace(/\{z\}/,i),-1!=s.lastIndexOf("{s}")){var n=this.map.domains||[""];s=s.replace(/\{s\}/,n[parseInt(Math.random()*n.length)])}return s}function h(t,e){return t>this.latLngBounds[0]?!1:e<this.latLngBounds[1]?!1:t<this.latLngBounds[2]?!1:t>this.latLngBounds[3]?!1:!0}function a(t){return this.latLngBounds[0]>=t[0]&&this.latLngBounds[1]>=t[1]&&this.latLngBounds[2]<=t[2]&&this.latLngBounds[3]<=t[3]}function u(t){return!(t[0]<this.latLngBounds[2]||t[1]>this.latLngBounds[3]||t[2]>this.latLngBounds[0]||t[3]<this.latLngBounds[1])}function l(){this.map=c,delete this.map,this.meterBounds=c,delete this.meterBounds,this.pixelBounds=c,delete this.pixelBounds,delete this.viewRectPosition,delete this.latLngBounds,delete this.img,this.eventEmitter.removeAllListeners(),delete this.eventEmitter}var c,f=t.prototype;return f.constructor=t,f.initFromTileXY=e,f.initFromQuadKey=n,f.load=r,f.getMapUrl=o,f.containsLatLng=h,f.isContained=a,f.intersect=u,f.dispose=l,t.ON_TILE_LOADED=0,t}()},{"./Mercator":4,events:1}],7:[function(t,e,i){arguments[4][4][0].apply(i,arguments)},{dup:4}]},{},[2])(2)});