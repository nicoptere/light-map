!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Map=t()}}(function(){return function t(e,i,s){function n(o,h){if(!i[o]){if(!e[o]){var a="function"==typeof require&&require;if(!h&&a)return a(o,!0);if(r)return r(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var u=i[o]={exports:{}};e[o][0].call(u.exports,function(t){var i=e[o][1][t];return n(i?i:t)},u,u.exports,t,e,i,s)}return i[o].exports}for(var r="function"==typeof require&&require,o=0;o<s.length;o++)n(s[o]);return n}({1:[function(t,e){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function s(t){return"function"==typeof t}function n(t){return"number"==typeof t}function r(t){return"object"==typeof t&&null!==t}function o(t){return void 0===t}e.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(t){if(!n(t)||0>t||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},i.prototype.emit=function(t){var e,i,n,h,a,l;if(this._events||(this._events={}),"error"===t&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;throw TypeError('Uncaught, unspecified "error" event.')}if(i=this._events[t],o(i))return!1;if(s(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:for(n=arguments.length,h=new Array(n-1),a=1;n>a;a++)h[a-1]=arguments[a];i.apply(this,h)}else if(r(i)){for(n=arguments.length,h=new Array(n-1),a=1;n>a;a++)h[a-1]=arguments[a];for(l=i.slice(),n=l.length,a=0;n>a;a++)l[a].apply(this,h)}return!0},i.prototype.addListener=function(t,e){var n;if(!s(e))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,s(e.listener)?e.listener:e),this._events[t]?r(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,r(this._events[t])&&!this._events[t].warned){var n;n=o(this._maxListeners)?i.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())}return this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(t,e){function i(){this.removeListener(t,i),n||(n=!0,e.apply(this,arguments))}if(!s(e))throw TypeError("listener must be a function");var n=!1;return i.listener=e,this.on(t,i),this},i.prototype.removeListener=function(t,e){var i,n,o,h;if(!s(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(i=this._events[t],o=i.length,n=-1,i===e||s(i.listener)&&i.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(r(i)){for(h=o;h-->0;)if(i[h]===e||i[h].listener&&i[h].listener===e){n=h;break}if(0>n)return this;1===i.length?(i.length=0,delete this._events[t]):i.splice(n,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},i.prototype.removeAllListeners=function(t){var e,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[t],s(i))this.removeListener(t,i);else for(;i.length;)this.removeListener(t,i[i.length-1]);return delete this._events[t],this},i.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?s(this._events[t])?[this._events[t]]:this._events[t].slice():[]},i.listenerCount=function(t,e){var i;return i=t._events&&t._events[e]?s(t._events[e])?1:t._events[e].length:0}},{}],2:[function(t,e){var i=t("./Mercator"),s=t("./MapUtils"),n=t("./Rect"),r=t("./Tile"),o=t("events");e.exports=function(){function t(t,e,n,r,h,a){this.mercator=new i(256),this.eventEmitter=new o.EventEmitter,this._minZoom=Math.max(0,h),this._maxZoom=Math.max(1,a),this.latitude=0,this.longitude=0,this.zoom=0,this.tiles=[],this.keys=[],this.loadedTiles=[],this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.setSize(n,r),this.setProvider(t,e,256*window.devicePixelRatio),this.utils=s}function e(t,e,s){this.provider!=t&&(this.dispose(),this.provider=t||"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",this.domains=e||["a","b","c"],this.scale=s/256,this.mercator=new i(256*this.scale),this.setSize(this._width,this._height))}function h(t,e){this._width=t||256,this._height=e||256,this.viewRect=new n(0,0,this._width,this._height),null!=this.canvas&&(this.canvas.width=this.viewRect.w*this.scale,this.canvas.height=this.viewRect.h*this.scale,this.canvas.style.width=this.viewRect.w+"px",this.canvas.style.height=this.viewRect.h+"px")}function a(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);var e=this.getViewRectCenterPixels(),i=this.ctx,s=this.zoom,n=this.viewRect,r=this.scale;this.loadedTiles.forEach(function(t){if(t.zoom==s){var o=n.w/2*r+(t.px-e[0]),h=n.h/2*r+(t.py-e[1]);i.drawImage(t.img,Math.round(o),Math.round(h))}}),this.eventEmitter.emit(t.ON_TEXTURE_UPDATE,this.ctx)}function l(t,e,i){var s=this.mercator.latLngToPixels(-t,e,i),n=this.viewRect.w*this.scale,r=this.viewRect.h*this.scale,o=this.mercator.pixelsToLatLng(s[0]-n/2*this.scale,s[1]-r/2*this.scale,i),h=this.mercator.pixelsToLatLng(s[0]+n/2*this.scale,s[1]+r/2*this.scale,i);return[-o[0],o[1],-h[0],h[1]]}function u(){var t=this.viewRectToLatLng(this.latitude,this.longitude,this.zoom);return{left:t[1],top:t[0],right:t[3],bottom:t[2]}}function c(){var t=this.viewRectToLatLng(this.latitude,this.longitude,this.zoom,this.viewRect);return[s.map(.5,0,1,-t[0],-t[2]),s.map(.5,0,1,t[1],t[3])]}function d(){return this.mercator.latLngToPixels(-this.latitude,this.longitude,this.zoom)}function f(t){t=t||this.zoom;for(var e=l(this.latitude,this.longitude,t,this.viewRect),i=this.mercator.latLonToTile(-e[0],e[1],t),s=this.mercator.latLonToTile(-e[2],e[3],t),n=0,r=0,o=[],h=i[0];h<=s[0];h++){r=0;for(var a=i[1];a<=s[1];a++){for(var u=this.mercator.tileXYToQuadKey(h,a,t),c=!1,d=0;d<this.loadedTiles.length;d++)if(this.loadedTiles[d].key==u){this.loadedTiles[d].viewRectPosition[0]=n,this.loadedTiles[d].viewRectPosition[1]=r,o.push(this.loadedTiles[d]),c=!0;break}if(0==c)for(d=0;d<this.tiles.length;d++)if(this.tiles[d].key==u){this.tiles[d].viewRectPosition[0]=n,this.tiles[d].viewRectPosition[1]=r,o.push(this.tiles[d]),c=!0;break}r++}n++}return o}function m(t,e,i,s){for(var n=this.viewRectToLatLng(t,e,i,s),o=this.mercator.latLonToTile(-n[0],n[1],i),h=this.mercator.latLonToTile(-n[2],n[3],i),a=[],l=o[0];l<=h[0];l++)for(var u=o[1];u<=h[1];u++){var c=this.mercator.tileXYToQuadKey(l,u,i);if(-1==this.keys.indexOf(c)){var d=new r(this,c);a.push(d),this.keys.push(c)}}return a}function v(t,e,i){this.latitude=t||this.latitude,this.longitude=e||this.longitude,this.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,i||this.zoom)),this.load(),this.renderTiles()}function p(){var e=this.getVisibleTiles(this.latitude,this.longitude,this.zoom,this.viewRect);if(0==e.length&&0==this.tiles.length)return void this.eventEmitter.emit(t.ON_LOAD_COMPLETE,-1);for(var i=0;i<e.length;i++)e[i].eventEmitter.on(r.ON_TILE_LOADED,this.appendTile),e[i].load();this.tiles=this.tiles.concat(e)}function g(e){var i=e.map;i.tiles.splice(i.tiles.indexOf(e),1);e.img;i.loadedTiles.push(e),i.renderTiles(!0),i.eventEmitter.emit(t.ON_TILE_LOADED,e),0==i.tiles.length&&i.eventEmitter.emit(t.ON_LOAD_COMPLETE,0)}function x(t,e,i){return this.mercator.latLngToPixels(-t,e,i||this.zoom)}function L(t){return t=t||this.zoom,this.mercator.resolution(t)}function T(){var t=this;this.tiles.forEach(function(e){e.eventEmitter.removeListener(r.ON_TILE_LOADED,t.appendTile),e.valid=!1,e.dispose()}),this.loadedTiles.forEach(function(t){t.dispose()}),this.tiles=[],this.loadedTiles=[],this.keys=[]}function _(t,e,i){var s=this.mercator.latLngToPixels(-t,e,i);return new n(s[0],s[1],this.viewRect.w,this.viewRect.h)}t.prototype={get width(){return this._width},set width(t){this._width=t,this.setSize(this.width,this.height)},get height(){return this._height},set height(t){this._height=t,this.setSize(this.width,this.height)},get minZoom(){return this._minZoom},set minZoom(t){this._minZoom=t},get maxZoom(){return this._maxZoom},set maxZoom(t){this._maxZoom=t}},t.ON_LOAD_COMPLETE=0,t.ON_TILE_LOADED=1,t.ON_TEXTURE_UPDATE=2;var w=t.prototype;return w.constructor=t,w.setProvider=e,w.setSize=h,w.renderTiles=a,w.latLngToPixels=x,w.viewRectToLatLng=l,w.getViewPortBounds=u,w.getViewRectCenter=c,w.getViewRectCenterPixels=d,w.setView=v,w.viewRectTiles=f,w.getVisibleTiles=m,w.load=p,w.appendTile=g,w.resolution=L,w.dispose=T,w.viewRectToPixels=_,t}()},{"./MapUtils":3,"./Mercator":4,"./Rect":5,"./Tile":6,events:1}],3:[function(t,e){e.exports.MapUtils=function(t){function e(t){return(t&-t)==t}function i(t){if(e(t))return t;for(var i=1;~~t>i;)i<<=1;return i}function s(t,e,i,s){var n=EARTH_RADIUS,r=t*h,o=i*h,a=(i-t)*h,l=(s-e)*h,u=Math.sin(a/2)*Math.sin(a/2)+Math.cos(r)*Math.cos(o)*Math.sin(l/2)*Math.sin(l/2),c=2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u));return n*c}function n(t,e,i){return e+t*(i-e)}function r(t,e,i){return(t-e)/(i-e)}function o(t,e,i,s,o){return n(r(t,e,i),s,o)}var h=Math.PI/180;return t.lerp=n,t.norm=r,t.map=o,t.isPowerOfTwo=e,t.powerTwo=i,t.latLngDistance=s,t}(e.exports)},{}],4:[function(t,e){e.exports=function(){function t(t,e){this.init(t,e)}function e(t,e){this.tileSize=t||256,this.earthRadius=e||6378137,this.initialResolution=2*Math.PI*this.earthRadius/this.tileSize,this.originShift=2*Math.PI*this.earthRadius/2}function i(t,e){var i=e*this.originShift/180,s=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180);return s=s*this.originShift/180,[i,s]}function s(t,e){var i=t/this.originShift*180,s=e/this.originShift*180;return s=180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2),[s,i]}function n(t,e,i){var s=this.resolution(i),n=t*s-this.originShift,r=e*s-this.originShift;return[n,r]}function r(t,e,i){var s=this.resolution(i),n=(t+this.originShift)/s,r=(e+this.originShift)/s;return[n,r]}function o(t,e,i){var s=this.metersToPixels(t,e,i);return this.pixelsToTile(s[0],s[1])}function h(t,e){var i=parseInt(Math.ceil(t/parseFloat(this.tileSize))-1),s=parseInt(Math.ceil(e/parseFloat(this.tileSize))-1);return[i,s]}function a(t,e,i){var s=this.latLngToPixels(t,e,i);return this.pixelsToTile(s[0],s[1])}function l(t,e,i){var s=this.tileSize<<i;return[t,s-e]}function u(t,e,i){var s=this.pixelsToMeters(t*this.tileSize,e*this.tileSize,i),n=this.pixelsToMeters((t+1)*this.tileSize,(e+1)*this.tileSize,i);return[s[0],s[1],n[0],n[1]]}function c(t,e,i){var s=this.tileMetersBounds(t,e,i),n=this.metersToPixels(s[0],s[1],i),r=this.metersToPixels(s[2],s[3],i);return[n[0],n[1],r[0],r[1]]}function d(t,e,i){var s=this.tileMetersBounds(t,e,i),n=this.metersToLatLon(s[0],s[1]),r=this.metersToLatLon(s[2],s[3]);return[n[0],n[1],r[0],r[1]]}function f(t){return this.initialResolution/Math.pow(2,t)}function m(t){for(var e=30;t>this.resolution(e);)if(e--,0>=e)return 0;return e}function v(t,e,i){var s=this.pixelsToMeters(t,e,i);return this.metersToLatLon(s[0],s[1])}function p(t,e,i){var s=this.latLonToMeters(t,e,i);return this.metersToPixels(s[0],s[1],i)}function g(t,e,i){var s=this.latLonToMeters(t,e);return this.metersToTile(s[0],s[1],i)}function x(t,e,i){for(var s="",n=i;n>0;n--){var r=0,o=1<<n-1;0!=(t&o)&&r++,0!=(e&o)&&(r++,r++),s+=r}return s}function L(t){for(var e=0,i=0,s=t.split(""),n=s.length,r=n;r>0;r--){var o=1<<r-1;switch(s[n-r]){case"0":break;case"1":e|=o;break;case"2":i|=o;break;case"3":e|=o,i|=o;break;default:return null}}return{tx:e,ty:i,zoom:n}}var T=t.prototype;return T.constructor=t,T.init=e,T.latLonToMeters=i,T.metersToLatLon=s,T.pixelsToMeters=n,T.metersToPixels=r,T.metersToTile=o,T.pixelsToTile=h,T.latLonToTile=a,T.pixelsToRaster=l,T.tileMetersBounds=u,T.tilePixelsBounds=c,T.tileLatLngBounds=d,T.resolution=f,T.zoomForPixelSize=m,T.pixelsToLatLng=v,T.latLngToPixels=p,T.latLngToTile=g,T.tileXYToQuadKey=x,T.quadKeyToTileXY=L,t}()},{}],5:[function(t,e){e.exports=function(){function t(t,e,i,s){this.x=t,this.y=e,this.w=i,this.h=s}function e(t,e){return t<this.x?!1:e<this.y?!1:t>this.x+this.w?!1:e<=this.y+this.h}function i(t,e,i,s){return this.x>=t&&this.y>=e&&this.x+this.w<=t+i&&this.y+this.h<=e+s}function s(t,e,i,s){return!(t>this.x+this.w||t+i<this.x||e>this.y+this.h||e+s<this.y)}function n(e){if(this.intersect(e.x,e.y,e.x+e.w,e.y+e.h)){var i=Math.max(this.x,e.x),s=Math.max(this.y,e.y),n=Math.min(this.x+this.w,e.x+e.w)-i,r=Math.min(this.y+this.h,e.y+e.h)-s;return new t(i,s,n,r)}return null}t.prototype={get x(){return this._x},set x(t){return this._x=t,this._x},get y(){return this._y},set y(t){return this._y=t,this._y},get w(){return this._w},set w(t){return this._w=t,this._w},get h(){return this._h},set h(t){return this._h=t,this._h}};var r=t.prototype;return r.constructor=t,r.containsPoint=e,r.isContained=i,r.intersect=s,r.intersection=n,t}()},{}],6:[function(t,e){var i=t("events");e.exports=function(){function t(t,e){if(null==t)throw new Error("Tile: no map associated to Tile.");this.map=t,this.valid=!0,this.loaded=!1,this.key="",this.id=-1,this.tx=-1,this.ty=-1,this.zoom=-1,this.lat=-1,this.lng=-1,this.meterBounds=c,this.mx=-1,this.my=-1,this.pixelBounds=c,this.px=-1,this.py=-1,this.rx=0,this.ry=0,this.viewRectPosition=[0,0],this.latLngBounds=c,this.img=new Image,this.url="",this.eventEmitter=new i.EventEmitter,this.quadKey=this.key=e,this.quadKey!=c&&this.initFromQuadKey(this.quadKey)}function e(t,e,i){var n=this.map.mercator.tileXYToQuadKey(t,e,i);s(n)}function s(t){var e=this.map.mercator.quadKeyToTileXY(t);if(e==c)return void(this.valid=!1);var i=this.map.mercator.tileLatLngBounds(this.tx+.5,this.ty+.5,this.zoom);this.lat=-i[0],this.lng=i[1],this.key=t,this.id=parseInt(t),this.tx=e.tx,this.ty=e.ty,this.zoom=e.zoom,this.meterBounds=this.map.mercator.tileMetersBounds(this.tx,this.ty,this.zoom),this.mx=this.meterBounds[0],this.my=this.meterBounds[1],this.pixelBounds=this.map.mercator.tilePixelsBounds(this.tx,this.ty,this.zoom),this.px=this.pixelBounds[0],this.py=this.pixelBounds[1],this.latLngBounds=this.map.mercator.tileLatLngBounds(this.tx,this.ty,this.zoom),this.latLngBounds[0]*=-1,this.latLngBounds[2]*=-1,this.url=this.getMapUrl(this.tx,this.ty,this.zoom)}function n(){if(!this.valid)return void console.log("invalid tile, not loading");var e=this;this.img.tile=this,this.img.crossOrigin="anonymous",this.img.onload=function(i){return e.map==c?void console.warn("loaded Tile has no associated map > ",e.key,e.zoom):(e.map.mercator.tileSize!=i.target.width&&e.rescaleImage(i.target,e.map.mercator.tileSize,window.devicePixelRatio),e.loaded=!0,void e.eventEmitter.emit(t.ON_TILE_LOADED,e))},this.img.setAttribute("key",this.key),this.img.src=this.url}function r(t,e,i){var s=document.createElement("canvas"),n=s.width=t.width,r=s.height=t.height,o=s.getContext("2d");o.drawImage(t,0,0,n,r);for(var h=o.getImageData(0,0,n,r).data,a=o.createImageData(e,e),l=a.data,u=0;u<h.length;u+=4)for(var c=u/4%n*i,d=~~(u/4/n)*i,f=c;c+i>=f;f++)if(!(c>=e))for(var m=d;d+i>=m;m++){var v=4*(~~f+~~m*e);l[v]=h[u],l[v+1]=h[u+1],l[v+2]=h[u+2],l[v+3]=h[u+3]}s.width=s.height=e,a.data=l,o.putImageData(a,0,0),delete this.img,this.img=s}function o(t,e,i){var s=this.map.provider;if(s=s.replace(/\{x\}/,t),s=s.replace(/\{y\}/,e),s=s.replace(/\{z\}/,i),-1!=s.lastIndexOf("{s}")){var n=this.map.domains||[""];s=s.replace(/\{s\}/,n[parseInt(Math.random()*n.length)])}return s}function h(t,e){return t>this.latLngBounds[0]?!1:e<this.latLngBounds[1]?!1:t<this.latLngBounds[2]?!1:t>this.latLngBounds[3]?!1:!0}function a(t){return this.latLngBounds[0]>=t[0]&&this.latLngBounds[1]>=t[1]&&this.latLngBounds[2]<=t[2]&&this.latLngBounds[3]<=t[3]}function l(t){return!(t[0]<this.latLngBounds[2]||t[1]>this.latLngBounds[3]||t[2]>this.latLngBounds[0]||t[3]<this.latLngBounds[1])}function u(){this.map=c,delete this.map,this.meterBounds=c,delete this.meterBounds,this.pixelBounds=c,delete this.pixelBounds,delete this.viewRectPosition,delete this.latLngBounds,delete this.img,this.eventEmitter.removeAllListeners(),delete this.eventEmitter}var c,d=t.prototype;return d.constructor=t,d.initFromTileXY=e,d.initFromQuadKey=s,d.load=n,d.rescaleImage=r,d.getMapUrl=o,d.containsLatLng=h,d.isContained=a,d.intersect=l,d.dispose=u,t.ON_TILE_LOADED=0,t}()},{events:1}]},{},[2])(2)});