<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
</head>
<body>

<script>

    //nope

    // ascii geotiiff incomplete
    //http://www.cgiar-csi.org/data/srtm-90m-digital-elevation-database-v4-1
    //    ->
    //    http://data.cgiar-csi.org/srtm/tiles
    //
    //      * User name: data_public
    //      * Password: GDdci


        //http://maps-for-free.com/ lulz 4

    //ftp://ftp.cscs.ch/out/stockli/bluemarble/Blue_Marble_2002/ > FAT PNG lights, topo, clouds

//    pas mercator http://www.ngdc.noaa.gov/mgg/topo/gltiles.html

    //hillshade: http://maps.ngdc.noaa.gov/viewers/wcs-client/


    //ArcGis privé + service + passage de param cryptic
    //http://nicoptere.maps.arcgis.com/home/webmap/viewer.html?layers=58a541efc59545e6b7137f961d7de883&useExisting=1

    //pas d'accès au layer DEM
    //http://maps.ngdc.noaa.gov/arcgis/rest/services/etopo1/MapServer

//    incomplete pas mercator GEOTiff / ASCII
//    http://www.cgiar-csi.org/data/srtm-90m-digital-elevation-database-v4-1

    //nope


    //HGT 'spec'
    //http://dds.cr.usgs.gov/srtm/version1/Documentation/SRTM_Topo.txt

    //from http://www.viewfinderpanoramas.org/

    //search (rect)
    //http://www.imagico.de/map/demsearch.php

    //selector (click)
    //http://www.viewfinderpanoramas.org/Coverage%20map%20viewfinderpanoramas_org3.htm

    //data ?
    //https://dds.cr.usgs.gov/srtm/version2_1/SRTM3/Eurasia/



    var url = "unzipped/S10W139.hgt";
    var urls = [
        "./unzipped/N00E006.hgt",
        "./unzipped/N00E009.hgt",
        "./unzipped/N00E010.hgt"
    ];

    var request = new XMLHttpRequest();
    request.responseType = "arraybuffer";
    function loadNext()
    {
        var url = urls[ 0 ];
        urls.shift();
        request.open("GET", url, true);
        request.send(null);
    }

    var maximax = 0;
    request.onload = function (oEvent)
    {
        var arrayBuffer = request.response;
        if (arrayBuffer)
        {

            var dv = new DataView( arrayBuffer );

            var s = Math.sqrt( dv.byteLength / 2 );

            var canvas = document.createElement( 'canvas' );
            document.body.appendChild( canvas );

            canvas.width = canvas.height = s;
            var ctx = canvas.getContext("2d");

            var imageData = ctx.getImageData( 0,0,s,s );
            var data = imageData.data;

            //find bounds
            var min = 32767;
            var max = -32767;
            var undef = 0;
            for (var i = 0; i < dv.byteLength; i += 2 ) {
                var val = dv.getInt16( i );
                min = Math.min( min,val );
                max = Math.max( max,val );
            }

            //remap values
            var last = 0;
            for ( i = 0; i < dv.byteLength; i+= 2 ) {

                val = dv.getInt16( i );
                if( isNaN( val ) || val <= -32767 )
                {
                    undef++;
                    val = last;
                }
                else
                {
                    last = val;
                }

                val = Math.max( 0, ~~( val ) );

                var id = ( i / 2 ) * 4;
                data[id] = data[id + 1] = data[id + 2] = ~~( ( val / 4862 ) * 255 );
                data[id+3] = 0xFF;

            }
//            console.log( min, max, undef );
            maximax = Math.max(max, maximax );
            imageData.data = data;
            ctx.putImageData( imageData,0,0 );
        }

        if( urls.length > 0 )
        {
            loadNext();
        }else
        {
            console.log( 'max', maximax );
        }
    };
    loadNext();



</script>

</body>
</html>