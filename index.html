<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Light-map by nicoptere</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
      <script src="./example/light-map.min.js" type="application/javascript"></script>

  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Light-map</h1>
        <p>a light-weight XYZ viewer</p>

        <p class="view"><a href="https://github.com/nicoptere/light-map">View the Project on GitHub <small>nicoptere/light-map</small></a></p>


        <ul>
          <li><a href="https://github.com/nicoptere/light-map/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/nicoptere/light-map/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/nicoptere/light-map">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h3>


        <a id="welcome-to-github-pages" class="anchor" href="#welcome-to-github-pages" aria-hidden="true"><span class="octicon octicon-link"></span></a>foreword</h3>
        <p>the purpose of this lib is to provide a minimal engine to display a XYZ Tile Map like OSM, MapBox, MapQuest, Mapzen, Google Maps...
        there are already many APIs out there such as <a href="http://leafletjs.com/">leaflet</a> and they work fine, they are very comprehensive, well tested so I'd recommend them for a mainstream use.</p>
        <p>I found it impractical to work with for "advanced" use cases though ; I needed to draw the view in a canvas (something leaflet wasn't designed for) and had to hack my way so much so that I ended up rebuilding an engine from scratch.</p>
        <p>it's rough around the edges, not fully tested and has lots of room for improvement. in a word, it's not for the faint of the heart.</p>
        <p>you can jump to the <a href="#examples">examples</a> if you're not interested in the background.</p>


<h3><a id="basics" class="anchor" href="#basics" aria-hidden="true"><span class="octicon octicon-link"></span></a>basics</h3>

          <p>this is how you instantiate light map: </p>

<pre>
//import the script "light-map.min.js" somewhere in your page
//then:
var provider = "http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";
var domains = "a,b,c".split( ',' );
var map = new Map( provider, domains, 512,512,0,18 );
document.body.appendChild( map.canvas );
map.setView(0,0,1);</pre>


<p>which gives you this</p>

<canvas id="basic"></canvas>

<script>

    var map_basic = new Map( "http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", "a,b,c".split( ',' ), 0,0,0,18 );
    map_basic.canvas = document.getElementById("basic");
    map_basic.ctx = map_basic.canvas.getContext("2d");
    map_basic.setSize(512,512);
    map_basic.setView(0,0,1);

    function goHome()
    {
        var geoSuccess = function(position) {

            map_basic.latitude  = position.coords.latitude;
            map_basic.longitude = position.coords.longitude;
            map_basic.zoom = 17;
            map_basic.setView();
        };
        navigator.geolocation.getCurrentPosition(geoSuccess);
    }

</script>
the above is an actual map, loaded from the <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> XYZ.<br><br>

<p>the <strong>Map</strong> constructor takes 6 arguments which are respectively:
</p>

    <ul>
          <li><strong>provider</strong>: the urls of the <a href="#XYZ">XYZ</a></li>
          <li><strong>domains</strong>: an array of domains to fetch images from</li>
          <li><strong>width</strong>: the width of the view rect</li>
          <li><strong>height</strong>: the height of the view rect</li>
          <li><strong>minZoom</strong>: the minimum zoom level</li>
          <li><strong>maxZoom</strong>: the maximum zoom level</li>
    </ul>

<p>the map holds a <strong>canvas</strong> DOM element, this is what you should add to the DOM. you can also replace it ( along with the <strong>map.ctx</strong> property of map ) with the canvas of your choice like so:</p>

<pre>map.canvas = document.getElementById("myCanvas");
map.ctx = map.canvas.getContext("2d");
map.setSize(width,height);</pre>

<p>now try to push this button (& allow geolocation)</p>
<button style="width:100%;" onmousedown="goHome()">go home</button><br><br>
the button calls this method;
<pre>
function goHome()
{
    var geoSuccess = function(position) {

        map.latitude  = position.coords.latitude;
        map.longitude = position.coords.longitude;
        map.zoom = 17;
        map.setView();
    };
    navigator.geolocation.getCurrentPosition(geoSuccess);
}</pre>
<p>
here <strong>map.setView()</strong> is called without arguments, because <strong>map.latitude, map.longitude</strong> and <strong>map.zoom</strong> values are set before the call.<br>
usually, you'll use <strong>setView( lat, lon, zoom)</strong> directly where <strong>lat / lon</strong> are expressed in degrees and <strong>zoom</strong> is a zoom value comprised between the bounds you specified in the constructor.
    the method will compute the tiles required to cover the view rect and load them if necessary.



</p>

<h3><a id="XYZ" class="anchor" href="#XYZ" aria-hidden="true"><span class="octicon octicon-link"></span></a>XYZ?</h3>
          <p>one could say that XYZ is a "subset" of the TMS specification ; the XYZ refers to how the tiles are organized ( Z is for Zoom level ).</p>
<p>there are more and more XYZ providers made available, <a href="http://leaflet-extras.github.io/leaflet-providers/preview/">here's a list that gives an idea of the potential</a>.
if you have a shallow knowledge of what a XYZ is, don't worry, it's quite simple ; a map is decomposed into a <em>pyramid</em> of tiles and you're at the top of the pyramid.</p>
<p>each zoom level is a "slice" of that pyramid and each time you "zoom in" - when you go one level down in the pyramid - each tile is subdivided into 4 tiles with twice more detail.</p>

<p>so the amount of tiles grows quickly: at a <strong>zoom level 0</strong> - the top of the pyramid - only <strong>one tile</strong> is necessary to represent the world, at level <strong>16</strong>, you'll need <strong>65.536 tiles</strong> to cover the same area which is the number of pixels of the top level tile.</p>
<p>if you go up to <strong>level 21</strong>, <strong>2.097.152 tiles</strong> will be necessary to represent the original, unique, top of the pyramid tile.</p>

<p>that's quite a lot so usually, the XYZ are bound between levels 0 & 18. on the server, the tiles are stored in a specific way that allows for quick lookup. if you want to know more, there is this excellent article: <a href="https://msdn.microsoft.com/en-us/library/bb259689.aspx">Bing Maps Tile System</a> </p>
<p>note that due to the large amount of tiles to process, some XYZ providers will not allow high zoom level.</p>

          <p>usually, a provider url will look something like:</p>
          <pre>http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png</pre>
          <p>where</p>
          <ul>
              <li><strong>{s}</strong> is the (sub)domain</li>
              <li><strong>{z}</strong> is the zoom level of the tile</li>
              <li><strong>{x}</strong> is the X coordiate of the tile</li>
              <li><strong>{y}</strong> is the Y coordiate of the tile</li>
          </ul>
<p>when requesting a tile, the X, Y & Z values are replaced by the tile's XY and the map's zoom level and the (sub)domain is picked randomly amongst the domains' list passed as an argument to the constructor.</p>

<h3>switch providers</h3>
<p>you can change the provider on the fly like so:</p>

<fieldset style="border: none;">
    <label for="provider">XYZ provider</label><br>
    <select id="provider" onchange="setProvider()" style="width: 100%">
      <option id="osm" data-url="http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png" data-domains="a,b,c" selected>OSM</option>
      <option id="stamen" data-url="http://stamen-tiles-{s}.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.png" data-domains="a,b,c" >Stamen</option>
      <option id="mq" data-url="http://ttiles{s}.mqcdn.com/tiles/1.0.0/vy/sat/{z}/{x}/{y}.png" data-domains="01,02,03,04">MapQuest</option>
    </select>
    <fieldset style="border: 1px solid #eeeeee;">
      <legend>copyright</legend>
      <div id="copyright"></div>
    </fieldset>
</fieldset><br>
<canvas id="c_provider"></canvas>
<script>

    var copyrights = [
        "&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>"  ,
        "Map tiles by <a href=\"http://stamen.com\">Stamen Design</a>, <a href=\"http://creativecommons.org/licenses/by/3.0\">CC BY 3.0</a> &mdash; Map data &copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>",
        "Tiles Courtesy of <a href=\"http://www.mapquest.com/\">MapQuest</a> &mdash; Portions Courtesy NASA/JPL-Caltech and U.S. Depart. of Agriculture, Farm Service Agency', subdomains: '1234'"
    ];

    function setProvider()
    {

        var e = document.getElementById("provider");
        var provider = e.options[e.selectedIndex];

        if( map_provider.provider != provider.getAttribute( "data-url" ) )
        {
            map_provider.dispose();
            map_provider.provider = provider.getAttribute( "data-url" );
            map_provider.domains = provider.getAttribute( "data-domains").split( "," );
            document.getElementById( 'copyright').innerHTML = copyrights[ e.selectedIndex ];
        }
        map_provider.setView();

    }

    var map_provider = new Map( "", "", 0,0,0,18 );
    setProvider();

    map_provider.canvas = document.getElementById("c_provider");
    map_provider.ctx = map_provider.canvas.getContext("2d");

    map_provider.setSize(512,512);
    map_provider.setView(0,0,1);

</script>
          <p>just make sure you call <strong>map.dispose()</strong> before assigning the new provider/domains</p>
          <pre>
map_provider.dispose();
map_provider.provider = provider.getAttribute( "data-url" );
map_provider.domains = provider.getAttribute( "data-domains").split( "," );</pre>



<h3><a id="examples" class="anchor" href="#examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>examples</h3>
<p>there are 2 examples in the repo:</p>

<ul>
  <li><a href="http://nicoptere.github.io/light-map/example/">an example with the most common methods</a> let's you set the lat/lon/zoom, change the width/height of the canvas and monitor the load progress.</li>
  <li><a href="http://nicoptere.github.io/light-map/example/retina.html">an example of retina support</a> first I thought it wasn't much but it seems to be a big deal. it's based on the devicePixelRatio, ideally you should use a @2x provider but I did an internal nearest neighbour resize.</li>
  <li><a href="http://nicoptere.github.io/light-map/example/controls.html">a basic example of controls</a> you should be able to drag the map around.</li>
  <li>as the map output is a Canvas2D, this is <a href="http://nicoptere.github.io/light-map/example/basic.html">an example with a fixed setup</a> that shows how to post process the output (adding a vignette).</li>
</ul>
  <p><strong>warning:</strong> when you change the lat/lon values at high zoom levels, there will be MANY images queued for loading. use lon/lat with caution, at rather low zoom levels</p>

  <p>otherwise, having a canvas as an output for the map is a strong feature of this API. I'll try to push the "post process" a bit in the upcoming days.</p>
  <p>any feedback is welcome, you can hit me on on github or twitter (<a href="https://twitter.com/nicoptere">nicoptere</a>) </p>
  <p>that's it for now :)</p>

      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/nicoptere">nicoptere</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
